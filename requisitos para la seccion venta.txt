ğŸ”„ Flujo Completo de una Venta de Producto
1. Cliente agrega productos al carrito
Se almacenan temporalmente en carrito_compras (solo si estÃ¡ logueado).
Si es invitado, el carrito vive en la sesiÃ³n del navegador (no en BD).
2. Checkout: datos de contacto y mÃ©todo de pago
El cliente elige:

A. Si estÃ¡ registrado:
Se usa su usuario_id.
No se piden datos de contacto (ya estÃ¡n en su perfil).
B. Si es invitado:
Se piden: nombre, email, telÃ©fono, direcciÃ³n.
Se crea un registro en datos_consumidor_invitado.
Se guarda su id para vincularlo a la orden.
âœ… En ambos casos, se selecciona un mÃ©todo de pago (tarjeta, PayPal, etc.). 

3. ConfirmaciÃ³n de compra â†’ CreaciÃ³n de la orden
Se inserta en la base de datos:

ğŸ“¥ Tabla: ordenes
sql


âŒ„
INSERT INTO ordenes (
  usuario_id,           -- NULL si es invitado
  datos_invitado_id,    -- NULL si es usuario registrado
  total_q,
  estado_orden,
  tipo_entrega,
  direccion_entrega,
  metodo_pago_id,
  modificado_por,
  estado
) VALUES (
  2,                    -- o NULL
  NULL,                 -- o ID de datos_consumidor_invitado
  295.00,
  'pendiente',
  'retiro',
  'Zona 10...',
  1,                    -- Tarjeta
  1,                    -- Admin/Sistema
  'activo'
);
ğŸ“¥ Tabla: detalles_orden
sql


âŒ„
INSERT INTO detalles_orden (
  orden_id,
  producto_id,
  cantidad,
  precio_unitario_q,
  subtotal_q,
  modificado_por,
  estado
) VALUES (
  1,
  1,                    -- ProteÃ­na Roshi
  1,
  295.00,
  295.00,
  1,
  'activo'
);
ğŸ” Se repite por cada producto en el carrito. 

4. Procesamiento del pago
El frontend envÃ­a los datos de pago al backend (ej: CVV, email de PayPal).
El backend:
Valida los datos.
Simula o procesa el pago (en desarrollo, se asume Ã©xito).
Crea un registro en transacciones_pago.
ğŸ“¥ Tabla: transacciones_pago
sql


âŒ„
INSERT INTO transacciones_pago (
  orden_id,
  metodo_pago_id,
  monto_q,
  estado_transaccion,
  referencia_externa,
  detalles,             -- JSON con datos sensibles (CVV oculto en producciÃ³n)
  modificado_por,
  estado
) VALUES (
  1,
  1,
  295.00,
  'exitosa',
  'txn_roshi_001',
  '{"numero_tarjeta": "****1234", "cvv": "***"}',
  1,
  'activo'
);
ğŸ”’ En producciÃ³n real: Nunca guardes CVV ni nÃºmero completo. Usa un gateway (Stripe, PayPal) que devuelva un token. 

5. ActualizaciÃ³n del estado de la orden
sql



âŒ„
UPDATE ordenes 
SET 
  estado_orden = 'pagada',
  transaccion_id = 1
WHERE id = 1;
6. GeneraciÃ³n de la factura
ğŸ“¥ Tabla: facturas
sql



âŒ„
INSERT INTO facturas (
  orden_id,
  numero_factura,
  fecha_emision,
  total_q,
  tipo,
  estado_factura,
  modificado_por,
  estado
) VALUES (
  1,
  'FAC-2025-001',
  CURDATE(),
  295.00,
  'venta',
  'emitida',
  1,
  'activo'
);
ğŸ“¥ Tabla: facturas_detalle
sql


INSERT INTO facturas_detalle (
  factura_id,
  descripcion,
  cantidad,
  precio_unitario_q,
  subtotal_q,
  tipo_item,
  item_id,
  modificado_por,
  estado
) VALUES (
  1,
  'ProteÃ­na Roshi Fit Vainilla 1kg',
  1,
  295.00,
  295.00,
  'producto',
  1,
  1,
  'activo'
);
7. (Opcional) ActualizaciÃ³n de inventario
El sistema reduce el stock del producto:
sql


âŒ„
UPDATE productos 
SET stock = stock - 1 
WHERE id = 1;
Si el stock cae por debajo de stock_minimo, se genera una alerta en el panel de admin.
ğŸ‘ï¸ Â¿CÃ³mo lo ve el administrador?
En la secciÃ³n â€œVentasâ€ del panel de admin:

#001
MarÃ­a LÃ³pez
ProteÃ­na Roshi (1)
Q295.00
Tarjeta
âœ… Pagada
Ver â€¢ Imprimir factura
#002
Juan PÃ©rez (invitado)
Camiseta Negra (2)
Q240.00
PayPal
âœ… Pagada
Ver â€¢ Imprimir factura

Al hacer clic en â€œVerâ€, el admin ve:

Datos del cliente (registrado o invitado)
Lista de productos comprados
Detalles del pago (sin datos sensibles)
Factura (con opciÃ³n de descargar PDF)
âœ… Resumen: Tablas involucradas en una venta de producto
ordenes
Encabezado de la venta
detalles_orden
Productos comprados
datos_consumidor_invitado
Solo si es invitado
transacciones_pago
Registro del pago
facturas
+
facturas_detalle
Documento fiscal
productos
ActualizaciÃ³n de stock

ğŸ”’ Notas importantes
Los invitados no necesitan cuenta, pero sus datos se guardan para la orden.
Todas las ventas quedan registradas, ya sea por usuario o invitado.
El admin tiene visibilidad total en la secciÃ³n Ventas.
El stock se actualiza automÃ¡ticamente como aplicar transacciones (eso si lo requiere ya que se esta trabajando con react prisma y typescript por lo que desconosco (cabe mencionar que la base la tengo en mysql y no le he implementado nada ademas de las tablas)
